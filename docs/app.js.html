<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { dialogos } from "./dialogos.js";
import { mostrarElemento, ocultarElemento, aplicarEstilos } from "./helpers.js";
import { titoContenedorDialogo, titoImagen, titoContenedor, contenedorParrafoTito, AUDIO_TITO, imagenCerrarDialogo, IMAGENES_TITO} from "./tito.js"; 
import { psicologaContenedorDialogo, psicologaImagen, psicologaContenedor, contenedorParrafoPsicologa, AUDIO_PSICOLOGA, imagenCerrarDialogoPsicologa, IMAGENES_PSICOLOGA} from "./psicologa.js";

/** @type {HTMLElement} Elemento de imagen de Itzel */
const itzelImagen = document.querySelector('.itzel__imagen')

/** @type {HTMLElement} Contenedor principal de Itzel */
const itzelContenedor = document.querySelector('.itzel__contenedor');

/** @type {HTMLAudioElement} Audio de fondo del lobby */
const audioLobby = document.querySelector('.audio_lobby');

/** @type {HTMLButtonElement} Botón para controlar el sonido */
const btnSonido = document.querySelector('.btn-sonido');

/** @type {HTMLButtonElement} Botón para mostrar diálogos ocultos */
const btnDialogo = document.querySelector('.btn-dialogo');

/** @type {HTMLImageElement} Imagen del botón de sonido */
const btnSonidoImagen = document.querySelector('.btn-sonido img');

/** @type {HTMLElement} Elemento modal principal */
const modal = document.getElementById('modal'); 

/** @type {HTMLElement} Contenedor del contenido visual del modal */
const modalContenedorContenidoVisual = document.querySelector('.modal__contenido-visual'); 

/** @type {HTMLVideoElement} Video tutorial del modal */
const modalContenidoVideo = document.querySelector('.video__tutorial');;

/** @type {HTMLButtonElement} Botón para cerrar el modal */
const btnCerrarModal = document.querySelector('.modal__contenido__cerrar');

/** @type {HTMLButtonElement} Botón para abrir la galería */
const btnGaleria = document.querySelector('.btn-galeria');

/**
 * Rutas de las imágenes para el botón de sonido
 * @constant {Object}
 * @property {string} sonido_on - Ruta de la imagen cuando el sonido está activado
 * @property {string} sonido_off - Ruta de la imagen cuando el sonido está desactivado
 */
const IMAGENES_BTN_SONIDO = {
    sonido_on: 'src/img/sound_on_3d.png',
    sonido_off: 'src/img/sound_off_3d.png'
}

/**
 * Ruta de la imagen de la sala de psicología
 * @constant {string}
 */
const IMAGEN_SALA_PSICOLOGIA = 'src/img/psicologia.jpeg'

/** @type {number} Índice actual del diálogo en reproducción */
let dialogoIndice = 0; 

/** @type {boolean} Indica si se está ejecutando el efecto de escritura */
let isTyping = false; 

/** @type {HTMLElement|undefined} Referencia al diálogo que está oculto */
let dialogoOculto;

/** @type {boolean} Indica si el botón de diálogo está activado */
let btnDialogoActivated = false;  

/** @type {boolean} Indica si el modal de galería está abierto */
let isGaleriaModalOpen = false; 

document.addEventListener('DOMContentLoaded', () => {
    reproducirVideoTutorial();
    ocultarBotonDialogo();
})

btnCerrarModal.addEventListener('click', () => {
    if(!isGaleriaModalOpen){
        addAnimation();
        reproducirAudioLobby();
    }
    aplicarEstilos(modal, {display: 'none'});
    isGaleriaModalOpen = false;
    
})

imagenCerrarDialogoPsicologa.addEventListener('click', () => {
    establecerDialogoOculto(psicologaContenedorDialogo);
})

imagenCerrarDialogo.addEventListener('click', () => {
    establecerDialogoOculto(titoContenedorDialogo)
})

btnDialogo.addEventListener('click', mostrarDialogoOculto)

btnSonido.addEventListener('click', reproducirAudioLobby)

btnGaleria.addEventListener('click', () => {
    isGaleriaModalOpen = true; 
    const contenidoVisual = modalContenedorContenidoVisual.firstElementChild;
    if(contenidoVisual.tagName === 'VIDEO'){
        cambiarContenidoModal();
    }
    aplicarEstilos(modal, {display: 'flex'});
})

/**
 * Cambia el contenido del modal de video a imagen de la sala de psicología
 */
function cambiarContenidoModal(){
    const modalContenidoHeading = document.querySelector('.modal__contenido h4');
    const modalContenidoParrafo = document.querySelector('.modal__contenido p'); 

    modalContenedorContenidoVisual.removeChild(modalContenedorContenidoVisual.firstElementChild); 
    
    const nuevaImagen = document.createElement('img'); 
    nuevaImagen.src = IMAGEN_SALA_PSICOLOGIA;
    modalContenedorContenidoVisual.appendChild(nuevaImagen);

    modalContenidoHeading.textContent = 'Sala de Psicología';
    modalContenidoParrafo.textContent = 'Esta es una imagen real de cómo se ve este lugar en la vida real. De esta manera, si un día llegas a ir, ¡ya sabrás cómo es!'
    btnCerrarModal.textContent = 'Cerrar'; 
}

const clickTito = () => {
    manejarClicPersonaje(titoContenedor, 3, contenedorParrafoTito);
};

const clickPsicologa = () => {
    manejarClicPersonaje(psicologaContenedor, 5, contenedorParrafoPsicologa);
};

/**
 * Maneja el clic en un personaje y crea botón de continuar si es necesario
 * @async
 * @param {HTMLElement} contenedor - Contenedor del personaje
 * @param {number} indiceFinal - Índice en el que se debe crear el botón continuar
 * @param {HTMLElement} contenedorParrafo - Contenedor donde se agregará el botón
 */
const manejarClicPersonaje = async (contenedor, indiceFinal, contenedorParrafo) => {

    await manejarDialogos(contenedor);

    if (dialogoIndice === indiceFinal) {
        crearBotonContinuarEnElemento(contenedorParrafo);
    }
};

/**
 * Reproduce el video tutorial en loop
 * @async
 * @throws {Error} Si la reproducción automática es bloqueada por el navegador
 */
async function reproducirVideoTutorial(){
    modalContenidoVideo.loop = true;
    try {
        await modalContenidoVideo.play();
    } catch (err) {
        console.error("La reproducción automática del video fue bloqueada por el navegador.", err);
    }
}

/**
 * Maneja la reproducción de diálogos para un elemento específico
 * @async
 * @param {HTMLElement} elemento - Elemento que mostrará el diálogo
 */
async function manejarDialogos(elemento){
    if (dialogoIndice &lt; dialogos.length &amp;&amp; !isTyping) {
        if(btnDialogoActivated){
            btnDialogoActivated = false;
            ocultarBotonDialogo();
        }
        elemento.classList.remove('animate-clickable');
        elemento.classList.add('animate-talking');
        await mostrarDialogo();
        elemento.classList.remove('animate-talking')
        dialogoIndice++;
        addAnimation()
    }
}

function reproducirAudioLobby(){
    audioLobby.loop = true; 
    if(audioLobby.paused){
        btnSonidoImagen.src =IMAGENES_BTN_SONIDO.sonido_on;
        audioLobby.play();
    }else{
        btnSonidoImagen.src = IMAGENES_BTN_SONIDO.sonido_off;
        audioLobby.pause();
    }
}

function establecerDialogoOculto(elemento){
    if(isTyping) return;
    dialogoOculto = elemento;
    ocultarElemento(dialogoOculto); 
    btnDialogoActivated = true;
    mostarBotonDialogo();
}

function mostrarDialogoOculto(){
    ocultarBotonDialogo();
    btnDialogoActivated = false;
    mostrarElemento(dialogoOculto);
}

/**
 * Crea y agrega un botón de continuar en el elemento especificado
 * @param {HTMLElement} elemento - Elemento donde se agregará el botón
 */
function crearBotonContinuarEnElemento(elemento){
    const buttonContinuar = document.createElement('button'); 
    buttonContinuar.textContent = 'Continuar';
    buttonContinuar.classList.add('btn-continuar', 'animate-clickable');
    elemento.appendChild(buttonContinuar); 
    buttonContinuar.addEventListener('click', () => {
        posicionarElementos();
        elemento.removeChild(buttonContinuar)
    })
}

function ocultarBotonDialogo(){
    btnDialogo.style.display = 'none';
}

function mostarBotonDialogo(){
    btnDialogo.style.display = 'inline-block';
}

/**
 * Agrega animación de clickable al personaje que debe hablar a continuación
 * y gestiona los event listeners correspondientes
 */
function addAnimation(){
    if (dialogoIndice > dialogos.length-1) return;
    const currentCharacter = dialogos[dialogoIndice].personaje;
    if(currentCharacter === 'Tito'){
        titoContenedor.classList.add('animate-clickable');
        psicologaContenedor.removeEventListener('click', clickPsicologa)
        titoImagen.addEventListener('click', clickTito);
    }else if(currentCharacter === 'Psicóloga'){
        psicologaContenedor.classList.add('animate-clickable');
        titoImagen.removeEventListener('click', clickTito); 
        psicologaContenedor.addEventListener('click', clickPsicologa)  
    }
}

/**
 * Configura la posición intermedia de los personajes a partir del dialogo 3
 * - Oculta a Tito
 * - Posiciona a la Psicóloga al centro
 * - Ajusta el tamaño de Itzel
 */
function configurarPosicionIntermedia() {

    // Ocultar Tito
    titoContenedor.classList.add('oculto');
    titoContenedorDialogo.classList.remove('flex');
    titoContenedorDialogo.classList.add('oculto');

    // Psicóloga
    aplicarEstilos(psicologaContenedor, {
        gridColumnStart: '2',
        gridColumnEnd: '3',
        height: '75%'
    });
    aplicarEstilos(psicologaImagen, {
        transform: 'scale(1.25)',
        marginLeft: '2rem'
    });
    aplicarEstilos(psicologaContenedorDialogo, {
        gridColumnStart: '3',
        gridColumnEnd: '5',
        height: '65%'
    });
    psicologaContenedor.classList.remove('oculto');

    // Itzel
    aplicarEstilos(itzelContenedor, { height: '85%' });
    aplicarEstilos(itzelImagen, { transform: 'scale(1)' });
}

/**
 * Configura la posición final de los personajes a partir del dialogo 5
 * - Muestra a Tito
 * - Reposiciona a la Psicóloga
 * - Ajusta el tamaño final de Itzel
 */
function configurarPosicionFinal() {
    // Tito
    aplicarEstilos(titoContenedor, {
        gridColumnStart: '3',
        gridColumnEnd: '4'
    });
    aplicarEstilos(titoContenedorDialogo, {
        gridColumnStart: '4',
        gridColumnEnd: '6'
    });
    titoContenedor.classList.remove('oculto');

    psicologaImagen.src = IMAGENES_PSICOLOGA.normal;
    ocultarElemento(psicologaContenedorDialogo);

    // Psicóloga
    aplicarEstilos(psicologaContenedor, {
        gridColumnStart: '2',
        gridColumnEnd: '3',
        height: '85%'
    });
    aplicarEstilos(psicologaImagen, {
        transform: 'scale(1.5)',
        marginLeft: '0'
    });
    aplicarEstilos(psicologaContenedorDialogo, {
        gridColumnStart: '3',
        gridColumnEnd: '5',
        height: '80%'
    });

    // Itzel
    aplicarEstilos(itzelContenedor, { height: '95%' });
    aplicarEstilos(itzelImagen, { transform: 'scale(1.2)' });
}

/**
 * Muestra el diálogo del personaje Tito
 * @async
 * @param {Object} dialogo - Objeto con la información del diálogo
 * @param {string} dialogo.texto - Texto del diálogo a mostrar
 */
async function mostrarDialogoTito(dialogo) {
    titoImagen.src = IMAGENES_TITO.hablando;
    psicologaImagen.src = IMAGENES_PSICOLOGA.normal;

    mostrarElemento(titoContenedorDialogo);
    ocultarElemento(psicologaContenedorDialogo);

    const titoParrafo = titoContenedorDialogo.querySelector('.tito__dialogo__parrafo');
    const titoHeadImagen = titoContenedorDialogo.querySelector('.tito__head__imagen');
    titoHeadImagen.classList.add('animate-talking-minihead');
    await generarEfectoTyping(dialogo.texto, titoParrafo,'Tito');
    titoHeadImagen.classList.remove('animate-talking-minihead');
}

/**
 * Muestra el diálogo del personaje Psicóloga
 * @async
 * @param {Object} dialogo - Objeto con la información del diálogo
 * @param {string} dialogo.texto - Texto del diálogo a mostrar
 */
async function mostrarDialogoPsicologa(dialogo) {

    psicologaImagen.src = IMAGENES_PSICOLOGA.hablando;
    titoImagen.src = IMAGENES_TITO.normal;

    mostrarElemento(psicologaContenedorDialogo);
    ocultarElemento(titoContenedorDialogo);

    const psicologaParrafo = psicologaContenedorDialogo.querySelector('.psicologa__dialogo__parrafo');
    const psicologaHeadImagen = document.querySelector('.psicologa__head__imagen');
    psicologaHeadImagen.classList.add('animate-talking-minihead');
    await generarEfectoTyping(dialogo.texto, psicologaParrafo,'Psicologa');
    psicologaHeadImagen.classList.remove('animate-talking-minihead');

}

/**
 * Muestra el diálogo actual según el personaje correspondiente
 * @async
 */
async function mostrarDialogo() {
    if (isTyping) return;
    isTyping = true;

    posicionarElementos();
    
    const dialogo = dialogos[dialogoIndice];

    if (dialogo.personaje === 'Tito') {
        await mostrarDialogoTito(dialogo);
    } else if (dialogo.personaje === 'Psicóloga') {
        await mostrarDialogoPsicologa(dialogo);
    }

    isTyping = false;
}

/**
 * Posiciona los elementos según el índice actual del diálogo
 * @async
 */
async function posicionarElementos() {
    if (dialogoIndice === 3) {
        configurarPosicionIntermedia();
    } else if (dialogoIndice === 5) {
        configurarPosicionFinal();
    }
}

/**
 * Genera un efecto de escritura tipo máquina de escribir con audio sincronizado
 * @async
 * @param {string} texto - Texto a mostrar con el efecto
 * @param {HTMLElement} elemento - Elemento donde se mostrará el texto
 * @param {string} characterName - Nombre del personaje que habla ('Tito' o 'Psicologa')
 * @param {number} [velocidad=30] - Velocidad de escritura en milisegundos por carácter
 */
async function generarEfectoTyping(texto, elemento, characterName, velocidad = 30) {
    elemento.textContent = ""; 

    let wordCounter = 0; 
    const WORDS_PER_SOUND = 3; 

    const audioSrc = characterName === 'Tito' ? AUDIO_TITO.src : AUDIO_PSICOLOGA.src;

    for (let i = 0; i &lt; texto.length; i++) {
        elemento.textContent += texto[i];
        const prevChar = i > 0 ? texto[i - 1] : ' ';
        const isWordBoundary = prevChar === ' ' || /[.!?;:]/.test(prevChar);

        if (isWordBoundary &amp;&amp; texto[i] !== ' ') {
            wordCounter++;
            if (wordCounter % WORDS_PER_SOUND === 0) {
                playFluentSound(audioSrc);
            }
        }
        await new Promise(resolve => setTimeout(resolve, velocidad));
    }
}

/**
 * Reproduce un sonido de voz con variación de tono para simular habla fluida
 * @param {string} url - URL del archivo de audio
 * @param {number} [volume=0.7] - Volumen del audio (0.0 a 1.0)
 */
function playFluentSound(url, volume = 0.7) {
    const audio = new Audio(url); 

    const randomPitch = 0.8 + Math.random() * 0.4;
    
    audio.playbackRate = randomPitch; 
    audio.preservesPitch = false; 

    audio.volume = volume;

    audio.currentTime = 0;
    
    audio.play().catch(e => {
        console.error("Error al reproducir sonido fluido:", e);
    });
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AUDIO_PSICOLOGA">AUDIO_PSICOLOGA</a></li><li><a href="global.html#IMAGENES_BTN_SONIDO">IMAGENES_BTN_SONIDO</a></li><li><a href="global.html#IMAGENES_PSICOLOGA">IMAGENES_PSICOLOGA</a></li><li><a href="global.html#IMAGEN_SALA_PSICOLOGIA">IMAGEN_SALA_PSICOLOGIA</a></li><li><a href="global.html#addAnimation">addAnimation</a></li><li><a href="global.html#aplicarEstilos">aplicarEstilos</a></li><li><a href="global.html#audioLobby">audioLobby</a></li><li><a href="global.html#btnCerrarModal">btnCerrarModal</a></li><li><a href="global.html#btnDialogo">btnDialogo</a></li><li><a href="global.html#btnDialogoActivated">btnDialogoActivated</a></li><li><a href="global.html#btnGaleria">btnGaleria</a></li><li><a href="global.html#btnSonido">btnSonido</a></li><li><a href="global.html#btnSonidoImagen">btnSonidoImagen</a></li><li><a href="global.html#cambiarContenidoModal">cambiarContenidoModal</a></li><li><a href="global.html#configurarPosicionFinal">configurarPosicionFinal</a></li><li><a href="global.html#configurarPosicionIntermedia">configurarPosicionIntermedia</a></li><li><a href="global.html#contenedorParrafoPsicologa">contenedorParrafoPsicologa</a></li><li><a href="global.html#crearBotonContinuarEnElemento">crearBotonContinuarEnElemento</a></li><li><a href="global.html#dialogoIndice">dialogoIndice</a></li><li><a href="global.html#dialogoOculto">dialogoOculto</a></li><li><a href="global.html#generarEfectoTyping">generarEfectoTyping</a></li><li><a href="global.html#imagenCerrarDialogoPsicologa">imagenCerrarDialogoPsicologa</a></li><li><a href="global.html#isGaleriaModalOpen">isGaleriaModalOpen</a></li><li><a href="global.html#isTyping">isTyping</a></li><li><a href="global.html#itzelContenedor">itzelContenedor</a></li><li><a href="global.html#itzelImagen">itzelImagen</a></li><li><a href="global.html#manejarClicPersonaje">manejarClicPersonaje</a></li><li><a href="global.html#manejarDialogos">manejarDialogos</a></li><li><a href="global.html#modal">modal</a></li><li><a href="global.html#modalContenedorContenidoVisual">modalContenedorContenidoVisual</a></li><li><a href="global.html#modalContenidoVideo">modalContenidoVideo</a></li><li><a href="global.html#mostrarDialogo">mostrarDialogo</a></li><li><a href="global.html#mostrarDialogoPsicologa">mostrarDialogoPsicologa</a></li><li><a href="global.html#mostrarDialogoTito">mostrarDialogoTito</a></li><li><a href="global.html#mostrarElemento">mostrarElemento</a></li><li><a href="global.html#ocultarElemento">ocultarElemento</a></li><li><a href="global.html#playFluentSound">playFluentSound</a></li><li><a href="global.html#posicionarElementos">posicionarElementos</a></li><li><a href="global.html#psicologaContenedor">psicologaContenedor</a></li><li><a href="global.html#psicologaContenedorDialogo">psicologaContenedorDialogo</a></li><li><a href="global.html#psicologaImagen">psicologaImagen</a></li><li><a href="global.html#reproducirVideoTutorial">reproducirVideoTutorial</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Tue Nov 25 2025 09:22:22 GMT-0600 (Central Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
